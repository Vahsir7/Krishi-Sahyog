{% extends "base.html" %}
{% block title %}Crop Selection{% endblock %}
{% block content %}
<div class="card p-4 shadow-sm"> {# Added shadow for better card definition #}
  <h3 class="mb-4">ðŸŒ¾ Crop Suggestion</h3>
  <p class="text-muted mb-4">Enter the field conditions to get a crop suggestion based on sustainability and yield.</p> {# Added text-muted #}

  {# --- Form remains the same --- #}
  <form id="crop-suggestion-form" method="post" action="/suggest_crop">
    <div class="row g-3">
      <div class="col-md-6 mb-3">
        <label for="soil_ph" class="form-label">Soil pH:</label>
        <input type="number" step="0.1" class="form-control" id="soil_ph" name="soil_ph" placeholder="e.g., 6.5" required>
      </div>
      <div class="col-md-6 mb-3">
        <label for="soil_moisture" class="form-label">Soil Moisture (%):</label>
        <input type="number" step="1" class="form-control" id="soil_moisture" name="soil_moisture" placeholder="e.g., 40" required>
      </div>
      <div class="col-md-6 mb-3">
        <label for="temperature" class="form-label">Temperature (Â°C):</label>
        <input type="number" step="1" class="form-control" id="temperature" name="temperature" placeholder="e.g., 25" required>
      </div>
      <div class="col-md-6 mb-3">
        <label for="rainfall" class="form-label">Rainfall (mm):</label>
        <input type="number" step="1" class="form-control" id="rainfall" name="rainfall" placeholder="e.g., 150" required>
      </div>
    </div>
    <button type="submit" class="btn btn-info mt-3">Suggest Crop</button>
  </form>

  {# --- Updated Results Section --- #}
  {% if suggestion %} {# Check if suggestion dictionary exists #}
  <div class="mt-4 p-3 border rounded bg-light response-box"> {# Added border, padding, light background #}
    <h5 class="mb-3">Suggestion Results:</h5> {# Added a sub-heading #}
    <p class="mb-2">
        <strong class="text-secondary">Input Conditions:</strong> pH={{ suggestion['input']['Soil_pH'] | round(1) }}, Moisture={{ suggestion['input']['Soil_Moisture'] | round(1) }}%, Temp={{ suggestion['input']['Temperature_C'] | round(1) }}Â°C, Rainfall={{ suggestion['input']['Rainfall_mm'] | round(1) }}mm
    </p>

    {# --- Case 1: Found a good sustainable match (Priority) --- #}
    {% if suggestion.found_sustainable %}
        <div class="alert alert-success"> {# Use alert for better visual cue #}
            <h6 class="alert-heading">ðŸŒ± Sustainable Suggestion: {{ suggestion.sustainable_crop.Crop_Type | default('N/A') }}</h6>
            <ul class="list-unstyled mb-0 small"> {# Smaller text for details #}
                <li><strong>Est. Fertilizer:</strong> {{ suggestion.sustainable_crop.Fertilizer_Usage_kg | round(1) | default('N/A') }} kg/ha</li>
                <li><strong>Est. Pesticide:</strong> {{ suggestion.sustainable_crop.Pesticide_Usage_kg | round(1) | default('N/A') }} kg/ha</li>
                <li><strong>Est. Yield:</strong> {{ suggestion.sustainable_crop.Crop_Yield_ton | round(2) | default('N/A') }} tons/ha</li>
                <li><strong>Sustainability Score:</strong> {{ suggestion.sustainable_crop.Sustainability_Score | round(1) | default('N/A') }}</li>
            </ul>
        </div>

    {# --- Case 2: No sustainable match, but found alternative yield crop --- #}
    {% elif suggestion.found_alternative %}
        <div class="alert alert-warning"> {# Use warning alert for alternative #}
             <h6 class="alert-heading">ðŸ“ˆ Alternative for Higher Yield: {{ suggestion.alternative_yield_crop.Crop_Type | default('N/A') }}</h6>
             <ul class="list-unstyled mb-0 small">
                <li><strong>Est. Yield:</strong> {{ suggestion.alternative_yield_crop.Crop_Yield_ton | round(2) | default('N/A') }} tons/ha</li>
                <li><em>(Sustainability Score: {{ suggestion.alternative_yield_crop.Sustainability_Score | round(1) | default('N/A') }})</em></li>
             </ul>
             {% if suggestion.condition_changes %}
                <hr> {# Add a separator #}
                <p class="mb-1 small"><strong>To optimize for this crop, consider adjusting:</strong></p>
                <ul class="list-unstyled ms-3 mb-0 small">
                    {% for condition, change in suggestion.condition_changes.items() %}
                        {% set target_val = suggestion.alternative_yield_crop[condition] %}
                        {% if change != 0 %}
                            <li>
                                {% if condition == 'Soil_pH' %} Soil pH by {{ change | round(2) }} (Target: {{ target_val | round(2) }})
                                {% elif condition == 'Soil_Moisture' %} Soil Moisture by {{ change | round(1) }}% (Target: {{ target_val | round(1) }}%)
                                {% elif condition == 'Temperature_C' %} Temperature by {{ change | round(1) }}Â°C (Target: {{ target_val | round(1) }}Â°C)
                                {% elif condition == 'Rainfall_mm' %} Rainfall/Irrigation by {{ change | round(1) }}mm (Target: {{ target_val | round(1) }}mm)
                                {% endif %}
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
            {% endif %}
        </div>

    {# --- Case 3: No matches found at all --- #}
    {% else %}
        <div class="alert alert-danger"> {# Use danger alert for no results #}
            <p class="mb-0">Could not find any relevant crop data in the dataset for conditions near your input.</p>
            {% if suggestion.error %}
               <hr>
               <p class="mb-0 small"><strong>Error:</strong> {{ suggestion.error }}</p>
            {% endif %}
        </div>
    {% endif %}
  </div>
  {% endif %} {# End suggestion exists check #}
</div>
{% endblock %}